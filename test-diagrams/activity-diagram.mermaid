flowchart TD
    Start([User Registration Process]) --> ValidateInput{Validate Input}
    
    ValidateInput -->|Invalid| ShowError[Show Validation Error]
    ShowError --> End([End])
    
    ValidateInput -->|Valid| CheckEmail{Email Exists?}
    CheckEmail -->|Yes| EmailError[Show Email Exists Error]
    EmailError --> End
    
    CheckEmail -->|No| CreateUser[Create User Account]
    CreateUser --> SendEmail[Send Welcome Email]
    
    SendEmail --> EmailSent{Email Sent?}
    EmailSent -->|Failed| LogError[Log Email Error]
    EmailSent -->|Success| SetActive[Set User Active]
    
    LogError --> SetActive
    SetActive --> NotifyAdmin[Notify Admin]
    NotifyAdmin --> Success[Registration Complete]
    Success --> End
    
    subgraph "Async Tasks"
        direction TB
        A1[Generate User Avatar] --> A2[Setup Default Preferences]
        A2 --> A3[Create Welcome Tutorial]
    end
    
    CreateUser -.-> A1
    
    classDef errorStyle fill:#ffcccc
    classDef successStyle fill:#ccffcc
    classDef processStyle fill:#cceeff
    
    class ShowError,EmailError,LogError errorStyle
    class Success successStyle
    class CreateUser,SendEmail,SetActive processStyle