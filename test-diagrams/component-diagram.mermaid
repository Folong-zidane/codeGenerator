graph TB
    subgraph "Presentation Layer"
        WEB[Web Controllers]
        API[REST API]
        AUTH[Authentication Filter]
    end
    
    subgraph "Business Layer"
        US[User Service]
        PS[Product Service]
        OS[Order Service]
        ES[Email Service]
        VS[Validation Service]
    end
    
    subgraph "Data Layer"
        UR[User Repository]
        PR[Product Repository]
        OR[Order Repository]
        CACHE[Redis Cache]
        DB[(PostgreSQL Database)]
    end
    
    subgraph "External Services"
        EMAIL[Email Provider]
        PAYMENT[Payment Gateway]
        AUDIT[Audit Service]
    end
    
    subgraph "Infrastructure"
        CONFIG[Configuration]
        METRICS[Metrics Collector]
        LOGS[Logging Service]
    end
    
    %% Presentation to Business
    WEB --> US
    WEB --> PS
    WEB --> OS
    API --> AUTH
    AUTH --> US
    
    %% Business to Data
    US --> UR
    PS --> PR
    OS --> OR
    US --> CACHE
    PS --> CACHE
    
    %% Data to Database
    UR --> DB
    PR --> DB
    OR --> DB
    
    %% Business to External
    US --> ES
    ES --> EMAIL
    OS --> PAYMENT
    US --> AUDIT
    OS --> AUDIT
    
    %% Cross-cutting concerns
    US --> VS
    PS --> VS
    OS --> VS
    
    %% Infrastructure
    US --> METRICS
    PS --> METRICS
    OS --> METRICS
    US --> LOGS
    PS --> LOGS
    OS --> LOGS
    
    classDef webLayer fill:#e3f2fd
    classDef businessLayer fill:#e8f5e8
    classDef dataLayer fill:#fff3e0
    classDef externalLayer fill:#fce4ec
    classDef infraLayer fill:#f3e5f5
    
    class WEB,API,AUTH webLayer
    class US,PS,OS,ES,VS businessLayer
    class UR,PR,OR,CACHE,DB dataLayer
    class EMAIL,PAYMENT,AUDIT externalLayer
    class CONFIG,METRICS,LOGS infraLayer