package com.basiccode.generator.service;

import com.basiccode.generator.model.*;
import com.basiccode.generator.parser.*;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

/**
 * Facade for coordinating multiple diagram parsers
 * Implements Facade pattern to simplify parser interactions
 */
@Service
public class DiagramParserFacade {
    
    private final ParserFactory parserFactory;
    
    @Autowired
    public DiagramParserFacade(ParserFactory parserFactory) {
        this.parserFactory = parserFactory;
    }
    
    /**
     * Parse class diagram
     */
    public Diagram parseClassDiagram(String content) throws ParseException {
        UmlParser<Diagram> parser = parserFactory.getParser(DiagramType.CLASS);
        return parser.parse(content);
    }
    
    /**
     * Parse sequence diagram
     */
    public SequenceDiagram parseSequenceDiagram(String content) throws ParseException {
        UmlParser<SequenceDiagram> parser = parserFactory.getParser(DiagramType.SEQUENCE);
        return parser.parse(content);
    }
    
    /**
     * Parse state diagram
     */
    public StateMachine parseStateDiagram(String content) throws ParseException {
        UmlParser<StateMachine> parser = parserFactory.getParser(DiagramType.STATE);
        return parser.parse(content);
    }
    
    /**
     * Auto-parse any diagram type
     */
    @SuppressWarnings("unchecked")
    public <T extends com.basiccode.generator.model.Diagram> T parseAnyDiagram(String content) throws ParseException {
        DiagramType type = parserFactory.detectDiagramType(content);
        UmlParser<T> parser = parserFactory.getParser(type);
        return parser.parse(content);
    }
    
    /**
     * Validate diagram content
     */
    public boolean validateDiagram(String content, DiagramType type) {
        try {
            UmlParser<?> parser = parserFactory.getParser(type);
            return parser.validate(content);
        } catch (Exception e) {
            return false;
        }
    }
}