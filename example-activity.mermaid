activityDiagram
    [*]
    
    activity ValidateUser as "Validate User Credentials"
    decision UserValid as "User Valid?"
    activity CreateSession as "Create User Session"
    
    activity ValidateOrder as "Validate Order Data"
    decision OrderValid as "Order Valid?"
    activity CheckInventory as "Check Product Inventory"
    decision StockAvailable as "Stock Available?"
    
    fork ProcessOrder
    activity CalculateTotal as "Calculate Order Total"
    activity ProcessPayment as "Process Payment"
    join OrderProcessed
    
    decision PaymentSuccess as "Payment Success?"
    activity ConfirmOrder as "Confirm Order"
    activity SendConfirmation as "Send Confirmation Email"
    
    activity UpdateInventory as "Update Inventory"
    activity LogTransaction as "Log Transaction"
    
    activity CancelOrder as "Cancel Order"
    activity RefundPayment as "Refund Payment"
    activity NotifyCustomer as "Notify Customer"
    
    end
    
    // Main flow
    [*] --> ValidateUser
    ValidateUser --> UserValid
    
    UserValid --> CreateSession : "Valid"
    UserValid --> end : "Invalid"
    
    CreateSession --> ValidateOrder
    ValidateOrder --> OrderValid
    
    OrderValid --> CheckInventory : "Valid"
    OrderValid --> end : "Invalid"
    
    CheckInventory --> StockAvailable
    
    StockAvailable --> ProcessOrder : "Available"
    StockAvailable --> NotifyCustomer : "Out of Stock"
    
    ProcessOrder --> CalculateTotal
    ProcessOrder --> ProcessPayment
    
    CalculateTotal --> OrderProcessed
    ProcessPayment --> OrderProcessed
    
    OrderProcessed --> PaymentSuccess
    
    PaymentSuccess --> ConfirmOrder : "Success"
    PaymentSuccess --> CancelOrder : "Failed"
    
    ConfirmOrder --> SendConfirmation
    SendConfirmation --> UpdateInventory
    UpdateInventory --> LogTransaction
    LogTransaction --> end
    
    CancelOrder --> RefundPayment
    RefundPayment --> NotifyCustomer
    NotifyCustomer --> end
    
    // Notes for documentation
    note right of ValidateUser : "Check user credentials against database"
    note left of ProcessOrder : "Parallel processing for efficiency"
    note bottom of PaymentSuccess : "Critical decision point for order flow"
    note top of UpdateInventory : "Update stock levels after successful order"